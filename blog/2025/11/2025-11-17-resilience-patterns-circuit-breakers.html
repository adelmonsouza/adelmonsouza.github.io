<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Day 17/30 â€” Resilience Patterns &amp; Circuit Breakers Â· The Java Place</title>
  <meta name="description" content="Day 17 do #30DiasJava: Resilience patterns com Resilience4j, circuit breakers, retry, timeout, rate limiting e bulkhead para sistemas resilientes." />
  <link rel="stylesheet" href="/styles.css" />
  <link rel="canonical" href="https://enouveau.io/blog/2025/11/2025-11-17-resilience-patterns-circuit-breakers.html" />
  <meta property="og:title" content="Day 17/30 â€” Resilience Patterns &amp; Circuit Breakers" />
  <meta property="og:description" content="Day 17 do #30DiasJava: Resilience patterns com Resilience4j, circuit breakers, retry, timeout, rate limiting e bulkhead para sistemas resilientes." />
  <meta property="og:type" content="article" />
  <meta property="og:url" content="https://enouveau.io/blog/2025/11/2025-11-17-resilience-patterns-circuit-breakers.html" />
  <meta property="article:published_time" content="2025-11-17T00:00:00.000Z" />
  <meta property="article:tag" content="Spring Boot" />
  <meta property="article:tag" content="Resilience4j" />
  <meta property="article:tag" content="Circuit Breaker" />
  <meta property="article:tag" content="Resilience Patterns" />
  <meta property="article:tag" content="Microservices" />
</head>
<body>
  <div class="background-glow"></div>
  <div class="app-shell">
    <header class="masthead">
  <div class="brand">
    <span>ğŸš€</span>
    <span>The Java Place</span>
  </div>
  <nav class="main-nav">
    <a href="/">Home</a>
    <a href="/blog/">Blog</a>
    <a href="/start-line/season-1-becoming-developer.html">Start Line</a>
    <a href="/resources/">Resources</a>
  </nav>
</header>
    
      <a class="back-link" href="/blog/">&larr; Voltar para o blog</a>
      <article class="article">
        <header>
          <span class="pill">30DaysOfJava</span>
          <h1>Day 17/30 â€” Resilience Patterns &amp; Circuit Breakers</h1>
          <p>Day 17 do #30DiasJava: Resilience patterns com Resilience4j, circuit breakers, retry, timeout, rate limiting e bulkhead para sistemas resilientes.</p>
          <div class="meta-line">
            <span>ğŸ“… 17 de novembro de 2025</span>
            <span>â±ï¸ 6 min read</span>
            <span>ğŸ—‚ï¸ 30DaysOfJava</span>
          </div>
        </header>
        <div class="article-body">
          <blockquote>
<p>&quot;Resilience nÃ£o Ã© sobre evitar falhas, Ã© sobre falhar graciosamente e se recuperar rapidamente.&quot; â€” <em>#30DiasJava Resilience Notes</em></p>
</blockquote>
<h2>ğŸ¯ Objetivo do Day 17</h2>
<p>Em sistemas distribuÃ­dos, falhas sÃ£o inevitÃ¡veis. O Day 17 do #30DiasJava implementou <strong>resilience patterns</strong> completos com Resilience4j: circuit breakers, retry, timeout, rate limiting e bulkhead para garantir que o sistema continue funcionando mesmo quando serviÃ§os externos falham.</p>
<h2>ğŸ› ï¸ O que foi implementado</h2>
<h3>âœ… Circuit Breaker Pattern</h3>
<ul>
<li><strong>Resilience4j integration</strong>: Circuit breakers automÃ¡ticos para chamadas externas</li>
<li><strong>Three states</strong>: CLOSED (normal), OPEN (falha), HALF_OPEN (testando recuperaÃ§Ã£o)</li>
<li><strong>Failure threshold</strong>: Abre apÃ³s X falhas consecutivas</li>
<li><strong>Wait duration</strong>: Tempo antes de tentar HALF_OPEN</li>
<li><strong>Success threshold</strong>: Falhas permitidas em HALF_OPEN antes de fechar</li>
<li><strong>Metrics</strong>: Estado, transiÃ§Ãµes, falhas registradas</li>
</ul>
<h3>âœ… Retry Pattern</h3>
<ul>
<li><strong>Exponential backoff</strong>: Retry com delay exponencial</li>
<li><strong>Max attempts</strong>: NÃºmero mÃ¡ximo de tentativas</li>
<li><strong>Retry conditions</strong>: Retry apenas em exceÃ§Ãµes especÃ­ficas</li>
<li><strong>Jitter</strong>: RandomizaÃ§Ã£o do delay para evitar thundering herd</li>
<li><strong>Metrics</strong>: Tentativas, sucessos, falhas</li>
</ul>
<h3>âœ… Timeout Pattern</h3>
<ul>
<li><strong>Call timeout</strong>: Timeout por chamada individual</li>
<li><strong>Global timeout</strong>: Timeout global para operaÃ§Ãµes</li>
<li><strong>Timeout exceptions</strong>: ExceÃ§Ãµes especÃ­ficas para timeout</li>
<li><strong>Metrics</strong>: Timeouts registrados, tempo mÃ©dio de resposta</li>
</ul>
<h3>âœ… Rate Limiting</h3>
<ul>
<li><strong>Request rate limiting</strong>: Limite de requisiÃ§Ãµes por perÃ­odo</li>
<li><strong>Thread pool limiting</strong>: Limite de threads simultÃ¢neas</li>
<li><strong>Dynamic limits</strong>: Limites ajustÃ¡veis em runtime</li>
<li><strong>Metrics</strong>: Requests permitidos, bloqueados, taxa atual</li>
</ul>
<h3>âœ… Bulkhead Pattern</h3>
<ul>
<li><strong>Thread pool isolation</strong>: Pools de threads separados por serviÃ§o</li>
<li><strong>Semaphore isolation</strong>: SemÃ¡foros para limitar concorrÃªncia</li>
<li><strong>Resource isolation</strong>: Isolamento de recursos por contexto</li>
<li><strong>Metrics</strong>: Threads ativas, requisiÃ§Ãµes em espera</li>
</ul>
<h2>ğŸ“Š Arquitetura</h2>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Client Service                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Resilience Layer (Resilience4j)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Circuit    â”‚  â”‚    Retry      â”‚  â”‚   Timeout    â”‚ â”‚
â”‚  â”‚   Breaker    â”‚  â”‚   Pattern     â”‚  â”‚   Pattern    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ Rate Limiter â”‚  â”‚  Bulkhead    â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              External Service / Database                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h2>ğŸ’» ImplementaÃ§Ã£o</h2>
<h3>DependÃªncias (pom.xml)</h3>
<pre><code class="language-xml">&lt;!-- Resilience4j --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;io.github.resilience4j&lt;/groupId&gt;
  &lt;artifactId&gt;resilience4j-spring-boot3&lt;/artifactId&gt;
  &lt;version&gt;2.1.0&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;io.github.resilience4j&lt;/groupId&gt;
  &lt;artifactId&gt;resilience4j-micrometer&lt;/artifactId&gt;
  &lt;version&gt;2.1.0&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;io.github.resilience4j&lt;/groupId&gt;
  &lt;artifactId&gt;resilience4j-reactor&lt;/artifactId&gt;
  &lt;version&gt;2.1.0&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<h3>ConfiguraÃ§Ã£o (application.yml)</h3>
<pre><code class="language-yaml">resilience4j:
  circuitbreaker:
    instances:
      paymentService:
        registerHealthIndicator: true
        slidingWindowSize: 10
        minimumNumberOfCalls: 5
        permittedNumberOfCallsInHalfOpenState: 3
        automaticTransitionFromOpenToHalfOpenEnabled: true
        waitDurationInOpenState: 10s
        failureRateThreshold: 50
        slowCallRateThreshold: 100
        slowCallDurationThreshold: 2s
      notificationService:
        registerHealthIndicator: true
        slidingWindowSize: 10
        minimumNumberOfCalls: 5
        waitDurationInOpenState: 5s
        failureRateThreshold: 50
  
  retry:
    instances:
      paymentService:
        maxAttempts: 3
        waitDuration: 1s
        enableExponentialBackoff: true
        exponentialBackoffMultiplier: 2
        retryExceptions:
          - java.net.ConnectException
          - java.util.concurrent.TimeoutException
        ignoreExceptions:
          - com.example.BusinessException
  
  timelimiter:
    instances:
      paymentService:
        timeoutDuration: 3s
        cancelRunningFuture: true
  
  ratelimiter:
    instances:
      paymentService:
        limitForPeriod: 10
        limitRefreshPeriod: 1s
        timeoutDuration: 0
        subscribeToEvents: true
        registerHealthIndicator: true
  
  bulkhead:
    instances:
      paymentService:
        maxConcurrentCalls: 10
        maxWaitDuration: 0
</code></pre>
<h3>Circuit Breaker Service</h3>
<pre><code class="language-java">@Service
@Slf4j
public class PaymentService {
    
    private final RestTemplate restTemplate;
    private final CircuitBreaker circuitBreaker;
    private final Retry retry;
    private final TimeLimiter timeLimiter;
    private final RateLimiter rateLimiter;
    private final Bulkhead bulkhead;
    
    public PaymentService(
            RestTemplate restTemplate,
            CircuitBreakerRegistry circuitBreakerRegistry,
            RetryRegistry retryRegistry,
            TimeLimiterRegistry timeLimiterRegistry,
            RateLimiterRegistry rateLimiterRegistry,
            BulkheadRegistry bulkheadRegistry) {
        this.restTemplate = restTemplate;
        this.circuitBreaker = circuitBreakerRegistry.circuitBreaker(&quot;paymentService&quot;);
        this.retry = retryRegistry.retry(&quot;paymentService&quot;);
        this.timeLimiter = timeLimiterRegistry.timeLimiter(&quot;paymentService&quot;);
        this.rateLimiter = rateLimiterRegistry.rateLimiter(&quot;paymentService&quot;);
        this.bulkhead = bulkheadRegistry.bulkhead(&quot;paymentService&quot;);
    }
    
    @CircuitBreaker(name = &quot;paymentService&quot;, fallbackMethod = &quot;processPaymentFallback&quot;)
    @Retry(name = &quot;paymentService&quot;)
    @TimeLimiter(name = &quot;paymentService&quot;)
    @RateLimiter(name = &quot;paymentService&quot;)
    @Bulkhead(name = &quot;paymentService&quot;)
    public CompletableFuture&lt;PaymentResponse&gt; processPayment(PaymentRequest request) {
        log.info(&quot;Processing payment: {}&quot;, request);
        
        return CompletableFuture.supplyAsync(() -&gt; {
            ResponseEntity&lt;PaymentResponse&gt; response = restTemplate.postForEntity(
                &quot;http://payment-service/api/payments&quot;,
                request,
                PaymentResponse.class
            );
            return response.getBody();
        });
    }
    
    public CompletableFuture&lt;PaymentResponse&gt; processPaymentFallback(
            PaymentRequest request, 
            Exception ex) {
        log.error(&quot;Payment service unavailable, using fallback&quot;, ex);
        
        // Fallback: Queue payment for later processing
        return CompletableFuture.completedFuture(
            PaymentResponse.builder()
                .status(&quot;QUEUED&quot;)
                .message(&quot;Payment queued for processing&quot;)
                .build()
        );
    }
}
</code></pre>
<h3>Resilience Decorator (Manual)</h3>
<pre><code class="language-java">@Service
@Slf4j
public class NotificationService {
    
    private final RestTemplate restTemplate;
    private final CircuitBreaker circuitBreaker;
    private final Retry retry;
    
    public NotificationService(
            RestTemplate restTemplate,
            CircuitBreakerRegistry circuitBreakerRegistry,
            RetryRegistry retryRegistry) {
        this.restTemplate = restTemplate;
        this.circuitBreaker = circuitBreakerRegistry.circuitBreaker(&quot;notificationService&quot;);
        this.retry = retryRegistry.retry(&quot;notificationService&quot;);
    }
    
    public void sendNotification(NotificationRequest request) {
        Supplier&lt;String&gt; decoratedSupplier = CircuitBreaker
            .decorateSupplier(circuitBreaker, () -&gt; {
                return Retry.decorateSupplier(retry, () -&gt; {
                    log.info(&quot;Sending notification: {}&quot;, request);
                    ResponseEntity&lt;String&gt; response = restTemplate.postForEntity(
                        &quot;http://notification-service/api/notifications&quot;,
                        request,
                        String.class
                    );
                    return response.getBody();
                }).get();
            });
        
        try {
            String result = Try.ofSupplier(decoratedSupplier)
                .recover(throwable -&gt; {
                    log.error(&quot;Notification failed, using fallback&quot;, throwable);
                    return &quot;Notification queued&quot;;
                })
                .get();
            
            log.info(&quot;Notification result: {}&quot;, result);
        } catch (Exception e) {
            log.error(&quot;Failed to send notification&quot;, e);
        }
    }
}
</code></pre>
<h3>Metrics &amp; Observability</h3>
<pre><code class="language-java">@Configuration
public class ResilienceMetricsConfig {
    
    @Bean
    public MeterRegistryCustomizer&lt;MeterRegistry&gt; resilienceMetricsCustomizer() {
        return registry -&gt; {
            // Circuit Breaker Metrics
            CircuitBreakerMetrics.ofCircuitBreakerRegistry(
                circuitBreakerRegistry()
            ).bindTo(registry);
            
            // Retry Metrics
            RetryMetrics.ofRetryRegistry(
                retryRegistry()
            ).bindTo(registry);
            
            // Rate Limiter Metrics
            RateLimiterMetrics.ofRateLimiterRegistry(
                rateLimiterRegistry()
            ).bindTo(registry);
            
            // Bulkhead Metrics
            BulkheadMetrics.ofBulkheadRegistry(
                bulkheadRegistry()
            ).bindTo(registry);
        };
    }
}
</code></pre>
<h3>Health Indicators</h3>
<pre><code class="language-java">@Component
public class ResilienceHealthIndicator implements HealthIndicator {
    
    private final CircuitBreakerRegistry circuitBreakerRegistry;
    
    public ResilienceHealthIndicator(CircuitBreakerRegistry circuitBreakerRegistry) {
        this.circuitBreakerRegistry = circuitBreakerRegistry;
    }
    
    @Override
    public Health health() {
        Health.Builder builder = new Health.Builder();
        
        circuitBreakerRegistry.getAllCircuitBreakers().forEach((name, circuitBreaker) -&gt; {
            CircuitBreaker.State state = circuitBreaker.getState();
            builder.withDetail(name + &quot;.state&quot;, state.name());
            builder.withDetail(name + &quot;.failureRate&quot;, 
                circuitBreaker.getMetrics().getFailureRate());
        });
        
        return builder.build();
    }
}
</code></pre>
<h2>ğŸ“ˆ MÃ©tricas e Observabilidade</h2>
<h3>Prometheus Metrics</h3>
<pre><code># Circuit Breaker Metrics
resilience4j_circuitbreaker_calls{name=&quot;paymentService&quot;,state=&quot;closed&quot;} 100
resilience4j_circuitbreaker_calls{name=&quot;paymentService&quot;,state=&quot;open&quot;} 5
resilience4j_circuitbreaker_calls{name=&quot;paymentService&quot;,state=&quot;half_open&quot;} 2
resilience4j_circuitbreaker_failure_rate{name=&quot;paymentService&quot;} 0.15
resilience4j_circuitbreaker_slow_calls{name=&quot;paymentService&quot;} 3

# Retry Metrics
resilience4j_retry_calls{name=&quot;paymentService&quot;,result=&quot;successful&quot;} 95
resilience4j_retry_calls{name=&quot;paymentService&quot;,result=&quot;failed&quot;} 5
resilience4j_retry_retries{name=&quot;paymentService&quot;} 12

# Rate Limiter Metrics
resilience4j_ratelimiter_available_permissions{name=&quot;paymentService&quot;} 8
resilience4j_ratelimiter_waiting_threads{name=&quot;paymentService&quot;} 2

# Bulkhead Metrics
resilience4j_bulkhead_available_concurrent_calls{name=&quot;paymentService&quot;} 7
resilience4j_bulkhead_threads_waiting{name=&quot;paymentService&quot;} 3
</code></pre>
<h3>Grafana Dashboard</h3>
<ul>
<li><strong>Circuit Breaker State</strong>: Estados (CLOSED/OPEN/HALF_OPEN) por serviÃ§o</li>
<li><strong>Failure Rate</strong>: Taxa de falha por serviÃ§o</li>
<li><strong>Retry Attempts</strong>: Tentativas de retry por serviÃ§o</li>
<li><strong>Rate Limiter</strong>: Requests permitidos/bloqueados</li>
<li><strong>Bulkhead</strong>: Threads ativas/em espera</li>
</ul>
<h2>ğŸ“ LiÃ§Ãµes Aprendidas</h2>
<h3>âœ… O que funcionou bem</h3>
<ul>
<li><strong>Circuit breakers previnem cascading failures</strong>: Isolam falhas antes que se espalhem</li>
<li><strong>Retry com exponential backoff</strong>: Reduz carga em serviÃ§os sobrecarregados</li>
<li><strong>Timeout evita hanging requests</strong>: Requests nÃ£o ficam travados indefinidamente</li>
<li><strong>Rate limiting protege serviÃ§os</strong>: Previne sobrecarga de requisiÃ§Ãµes</li>
<li><strong>Bulkhead isola recursos</strong>: Falhas em um serviÃ§o nÃ£o afetam outros</li>
</ul>
<h3>âš ï¸ Desafios e soluÃ§Ãµes</h3>
<ul>
<li><strong>ConfiguraÃ§Ã£o inicial complexa</strong>: Criamos templates de configuraÃ§Ã£o reutilizÃ¡veis</li>
<li><strong>MÃ©tricas podem ser overwhelming</strong>: Filtramos mÃ©tricas mais importantes no dashboard</li>
<li><strong>Fallback strategies</strong>: Implementamos fallbacks apropriados para cada contexto</li>
</ul>
<h2>ğŸ“š Recursos</h2>
<ul>
<li>Resilience4j: <a href="https://resilience4j.readme.io/">https://resilience4j.readme.io/</a></li>
<li>Circuit Breaker Pattern: <a href="https://martinfowler.com/bliki/CircuitBreaker.html">https://martinfowler.com/bliki/CircuitBreaker.html</a></li>
<li>Bulkhead Pattern: <a href="https://docs.microsoft.com/en-us/azure/architecture/patterns/bulkhead">https://docs.microsoft.com/en-us/azure/architecture/patterns/bulkhead</a></li>
<li>Retry Pattern: <a href="https://docs.microsoft.com/en-us/azure/architecture/patterns/retry">https://docs.microsoft.com/en-us/azure/architecture/patterns/retry</a></li>
</ul>
<h2>ğŸ”— Links</h2>
<ul>
<li>RepositÃ³rio: <a href="https://github.com/adelmonsouza/30DiasJava-Day17-Resilience">https://github.com/adelmonsouza/30DiasJava-Day17-Resilience</a></li>
</ul>
<p><strong>Next episode</strong> â†’ Day 18/30 â€” Service Mesh &amp; Istio (em breve)</p>

        </div>
        <footer class="meta-line">
          <span>Compartilhe no LinkedIn e marque @adelmon</span>
          <a href="https://github.com/adelmonsouza/30DiasJava-Day17-Resilience" target="_blank" rel="noopener noreferrer nofollow">CÃ³digo no GitHub</a>
        </footer>
      </article>
    
  </div>
  <footer class="site-footer">
  Â© 2025 E-Nouveau â€” The Java Place. Sem fluff, apenas engenharia de verdade.
</footer>
</body>
</html>