<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Day 14/30 â€” API Gateway &amp; Rate Limiting Â· The Java Place</title>
  <meta name="description" content="Day 14 do #30DiasJava: API Gateway centralizado com rate limiting por usuÃ¡rio/tenant, circuit breakers, request/response transformation e observabilidade completa." />
  <link rel="stylesheet" href="/styles.css" />
  <link rel="canonical" href="https://enouveau.io/blog/2025/11/2025-11-14-api-gateway-rate-limiting.html" />
  <meta property="og:title" content="Day 14/30 â€” API Gateway &amp; Rate Limiting" />
  <meta property="og:description" content="Day 14 do #30DiasJava: API Gateway centralizado com rate limiting por usuÃ¡rio/tenant, circuit breakers, request/response transformation e observabilidade completa." />
  <meta property="og:type" content="article" />
  <meta property="og:url" content="https://enouveau.io/blog/2025/11/2025-11-14-api-gateway-rate-limiting.html" />
  <meta property="article:published_time" content="2025-11-14T00:00:00.000Z" />
  <meta property="article:tag" content="Spring Boot" />
  <meta property="article:tag" content="API Gateway" />
  <meta property="article:tag" content="Rate Limiting" />
  <meta property="article:tag" content="Security" />
  <meta property="article:tag" content="Performance" />
</head>
<body>
  <div class="background-glow"></div>
  <div class="app-shell">
    <header class="masthead">
  <div class="brand">
    <span>ğŸš€</span>
    <span>The Java Place</span>
  </div>
  <nav class="main-nav">
    <a href="/">Home</a>
    <a href="/blog/">Blog</a>
    <a href="/start-line/season-1-becoming-developer.html">Start Line</a>
    <a href="/resources/">Resources</a>
  </nav>
</header>
    
      <a class="back-link" href="/blog/">&larr; Voltar para o blog</a>
      <article class="article">
        <header>
          <span class="pill">30DaysOfJava</span>
          <h1>Day 14/30 â€” API Gateway &amp; Rate Limiting</h1>
          <p>Day 14 do #30DiasJava: API Gateway centralizado com rate limiting por usuÃ¡rio/tenant, circuit breakers, request/response transformation e observabilidade completa.</p>
          <div class="meta-line">
            <span>ğŸ“… 14 de novembro de 2025</span>
            <span>â±ï¸ 4 min read</span>
            <span>ğŸ—‚ï¸ 30DaysOfJava</span>
          </div>
        </header>
        <div class="article-body">
          <blockquote>
<p>&quot;Um API Gateway Ã© a porta de entrada que protege, limita e observa todos os requests antes que cheguem aos microsserviÃ§os.&quot; â€” <em>#30DiasJava Gateway Notes</em></p>
</blockquote>
<h2>ğŸ¯ Objetivo do Day 14</h2>
<p>Com todos os serviÃ§os internos rodando, era hora de criar uma camada Ãºnica de entrada. O Day 14 do #30DiasJava entregou um <strong>API Gateway</strong> completo com rate limiting inteligente, circuit breakers, transformaÃ§Ã£o de requests/responses e observabilidade unificada.</p>
<h2>ğŸ› ï¸ O que foi implementado</h2>
<h3>âœ… API Gateway Centralizado</h3>
<ul>
<li><strong>Spring Cloud Gateway</strong>: Gateway reativo com rotas dinÃ¢micas</li>
<li><strong>Route configuration</strong>: YAML ou cÃ³digo para definir rotas, predicates e filters</li>
<li><strong>Request/Response transformation</strong>: ModificaÃ§Ã£o de headers, body, path</li>
<li><strong>Load balancing</strong>: DistribuiÃ§Ã£o de carga entre instÃ¢ncias do mesmo serviÃ§o</li>
<li><strong>SSL/TLS termination</strong>: TerminaÃ§Ã£o SSL no gateway</li>
</ul>
<h3>âœ… Rate Limiting AvanÃ§ado</h3>
<ul>
<li><strong>Token bucket algorithm</strong>: ImplementaÃ§Ã£o Redis-based para rate limiting distribuÃ­do</li>
<li><strong>Limits por usuÃ¡rio</strong>: Limites personalizados por <code>userId</code> (ex.: premium: 1000/min, free: 100/min)</li>
<li><strong>Limits por tenant</strong>: Limites por organizaÃ§Ã£o/tenant</li>
<li><strong>Limits por endpoint</strong>: Limites especÃ­ficos por rota (ex.: <code>/api/auth/login</code>: 5/min)</li>
<li><strong>Headers HTTP</strong>: <code>X-RateLimit-Limit</code>, <code>X-RateLimit-Remaining</code>, <code>X-RateLimit-Reset</code></li>
</ul>
<h3>âœ… Circuit Breakers</h3>
<ul>
<li><strong>Resilience4j integration</strong>: Circuit breakers automÃ¡ticos para rotas</li>
<li><strong>Fallback responses</strong>: Respostas padrÃ£o quando serviÃ§os estÃ£o down</li>
<li><strong>Retry policies</strong>: Retry com backoff exponencial</li>
<li><strong>Bulkhead isolation</strong>: Isolamento de recursos por rota</li>
</ul>
<h3>âœ… SeguranÃ§a e AutenticaÃ§Ã£o</h3>
<ul>
<li><strong>JWT validation</strong>: ValidaÃ§Ã£o centralizada de tokens no gateway</li>
<li><strong>API key authentication</strong>: Suporte a API keys para integraÃ§Ãµes</li>
<li><strong>IP whitelisting/blacklisting</strong>: Controle de acesso por IP</li>
<li><strong>CORS policy</strong>: ConfiguraÃ§Ã£o centralizada de CORS</li>
<li><strong>Request size limits</strong>: Limites de tamanho de request</li>
</ul>
<h3>âœ… Observabilidade</h3>
<ul>
<li><strong>Metrics por rota</strong>: Taxa de requests, latÃªncia, taxa de erro por rota</li>
<li><strong>Tracing distribuÃ­do</strong>: Correlation ID propagado automaticamente</li>
<li><strong>Access logs estruturados</strong>: Logs JSON com contexto rico</li>
<li><strong>Dashboard Grafana</strong>: VisÃ£o unificada de todas as rotas</li>
</ul>
<h2>ğŸ“Š Arquitetura</h2>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         API Gateway                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Rate Limiting (Redis)        â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ JWT Validation               â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ Circuit Breaker (Resilience4j)â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ Request Transformation       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â–¼              â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend  â”‚   â”‚ Payment  â”‚   â”‚ Search   â”‚
â”‚ Service  â”‚   â”‚ Service  â”‚   â”‚ Service  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h2>ğŸ”§ ImplementaÃ§Ã£o TÃ©cnica</h2>
<h3>1. DependÃªncias (<code>pom.xml</code>)</h3>
<pre><code class="language-xml">&lt;!-- Spring Cloud Gateway --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
  &lt;artifactId&gt;spring-cloud-starter-gateway&lt;/artifactId&gt;
&lt;/dependency&gt;

&lt;!-- Rate Limiting --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;com.github.vladimir-bukhtoyarov&lt;/groupId&gt;
  &lt;artifactId&gt;bucket4j-core&lt;/artifactId&gt;
  &lt;version&gt;8.10.0&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- Resilience4j --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;io.github.resilience4j&lt;/groupId&gt;
  &lt;artifactId&gt;resilience4j-spring-boot3&lt;/artifactId&gt;
&lt;/dependency&gt;

&lt;!-- Redis for distributed rate limiting --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
  &lt;artifactId&gt;spring-boot-starter-data-redis-reactive&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
<h3>2. Gateway Routes Configuration</h3>
<pre><code class="language-yaml">spring:
  cloud:
    gateway:
      routes:
        - id: backend-service
          uri: lb://backend-service
          predicates:
            - Path=/api/**
          filters:
            - name: RequestRateLimiter
              args:
                redis-rate-limiter.replenishRate: 100
                redis-rate-limiter.burstCapacity: 200
                key-resolver: &quot;#{@userKeyResolver}&quot;
            - name: CircuitBreaker
              args:
                name: backendCircuitBreaker
                fallbackUri: forward:/fallback
            - StripPrefix=1
        
        - id: auth-service
          uri: lb://auth-service
          predicates:
            - Path=/auth/**
          filters:
            - name: RequestRateLimiter
              args:
                redis-rate-limiter.replenishRate: 10
                redis-rate-limiter.burstCapacity: 20
                key-resolver: &quot;#{@ipKeyResolver}&quot;
</code></pre>
<h3>3. Custom Rate Limiter</h3>
<pre><code class="language-java">@Component
public class UserRateLimiter implements KeyResolver {
  @Override
  public Mono&lt;String&gt; resolve(ServerWebExchange exchange) {
    String userId = extractUserId(exchange);
    if (userId != null) {
      return Mono.just(userId);
    }
    return Mono.just(&quot;anonymous:&quot; + getClientIP(exchange));
  }
}
</code></pre>
<h2>ğŸ’¡ LiÃ§Ãµes do dia</h2>
<ul>
<li><strong>Rate limiting Ã© essencial</strong>: Protege contra abuso e garante fair usage</li>
<li><strong>Circuit breakers previnem cascading failures</strong>: Isolam falhas antes que se espalhem</li>
<li><strong>Gateway centraliza cross-cutting concerns</strong>: AutenticaÃ§Ã£o, rate limiting, observabilidade em um sÃ³ lugar</li>
<li><strong>Redis Ã© crucial</strong>: Rate limiting distribuÃ­do requer estado compartilhado</li>
<li><strong>Fallbacks melhoram UX</strong>: Respostas padrÃ£o quando serviÃ§os estÃ£o down</li>
</ul>
<h2>ğŸ“ˆ MÃ©tricas e Observabilidade</h2>
<ul>
<li><code>gateway.requests.total{route, status}</code>: Total de requests por rota</li>
<li><code>gateway.latency.seconds{route, percentile}</code>: LatÃªncia por rota</li>
<li><code>gateway.rate_limited.total{route}</code>: Requests bloqueados por rate limit</li>
<li><code>gateway.circuit_breaker.state{route}</code>: Estado do circuit breaker</li>
</ul>
<h2>ğŸ”— Recursos</h2>
<ul>
<li>RepositÃ³rio: <a href="https://github.com/adelmonsouza/30DiasJava-Day14-APIGateway">https://github.com/adelmonsouza/30DiasJava-Day14-APIGateway</a></li>
<li>Spring Cloud Gateway: <a href="https://spring.io/projects/spring-cloud-gateway">https://spring.io/projects/spring-cloud-gateway</a></li>
<li>Bucket4j: <a href="https://bucket4j.com/">https://bucket4j.com/</a></li>
<li>Resilience4j: <a href="https://resilience4j.readme.io/">https://resilience4j.readme.io/</a></li>
<li><strong>Projeto pessoal:</strong> Este Ã© um projeto do desafio #30DiasJava, mantido independentemente para fins educacionais.</li>
</ul>
<hr>
<p><strong>Next episode</strong> â†’ <a href="../2025-11-15-caching-strategies.md">Day 15/30 â€” Caching Strategies in Spring Boot</a></p>

        </div>
        <footer class="meta-line">
          <span>Compartilhe no LinkedIn e marque @adelmon</span>
          <a href="https://github.com/adelmonsouza/30DiasJava-Day14-APIGateway" target="_blank" rel="noopener noreferrer nofollow">CÃ³digo no GitHub</a>
        </footer>
      </article>
    
  </div>
  <footer class="site-footer">
  Â© 2025 E-Nouveau â€” The Java Place. Sem fluff, apenas engenharia de verdade.
</footer>
</body>
</html>