<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Day 17/30 â€” Error Handling &amp; Exception Management Â· The Java Place</title>
  <meta name="description" content="Day 17 do #30DiasJava: Tratamento centralizado de erros, respostas consistentes de API, logging estruturado e como evitar que um erro quebre toda a aplicaÃ§Ã£o." />
  <link rel="stylesheet" href="/styles.css" />
  <link rel="canonical" href="https://enouveau.io/blog/2025/11/2025-11-17-error-handling-exception-management.html" />
  <meta property="og:title" content="Day 17/30 â€” Error Handling &amp; Exception Management" />
  <meta property="og:description" content="Day 17 do #30DiasJava: Tratamento centralizado de erros, respostas consistentes de API, logging estruturado e como evitar que um erro quebre toda a aplicaÃ§Ã£o." />
  <meta property="og:type" content="article" />
  <meta property="og:url" content="https://enouveau.io/blog/2025/11/2025-11-17-error-handling-exception-management.html" />
  <meta property="article:published_time" content="2025-11-17T00:00:00.000Z" />
  <meta property="article:tag" content="Spring Boot" />
  <meta property="article:tag" content="Error Handling" />
  <meta property="article:tag" content="Exception Management" />
  <meta property="article:tag" content="API Design" />
  <meta property="article:tag" content="Best Practices" />
</head>
<body>
  <div class="background-glow"></div>
  <div class="app-shell">
    <header class="masthead">
  <div class="brand">
    <a href="/" style="display: inline-flex; align-items: center; gap: 12px; font-weight: 600; font-size: 1.5rem; color: var(--text-primary); letter-spacing: 0.02em; text-decoration: none;">
      <span>ğŸš€</span>
      <span>The Java Place</span>
    </a>
  </div>
  <nav class="main-nav">
    <a href="/">Home</a>
    <a href="/blog/">Blog</a>
    <a href="/blog/about.html">Sobre</a>
    <a href="/start-line/season-1-becoming-developer.html">Start Line</a>
    <a href="/resources/">Resources</a>
  </nav>
</header>
    
      
      <nav class="breadcrumbs" style="margin-bottom: 1.5rem; font-size: 0.9rem; color: var(--text-secondary);">
        <a href="/">Home</a>
        <span> / </span>
        <a href="/blog/">Blog</a>
        <span> / </span>
        <span>Day 17/30 â€” Error Handling &amp; Exception Management</span>
      </nav>
    
      <a class="back-link" href="/blog/">&larr; Voltar para o blog</a>
      
      <div class="audio-player" style="margin: 2rem 0; padding: 1.5rem; background: rgba(139, 92, 246, 0.1); border-radius: 16px; border: 1px solid rgba(139, 92, 246, 0.3);">
        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
          <span style="font-size: 1.5rem;">ğŸ™ï¸</span>
          <h3 style="margin: 0; font-size: 1.1rem;">OuÃ§a este post</h3>
        </div>
        <div class="language-selector" style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
          <button class="lang-btn active" data-lang="pt" style="padding: 0.5rem 1rem; border: 1px solid rgba(139, 92, 246, 0.5); background: rgba(139, 92, 246, 0.2); color: #d8b4fe; border-radius: 8px; cursor: pointer;">ğŸ‡§ğŸ‡· PortuguÃªs</button>
          <button class="lang-btn" data-lang="fr" style="padding: 0.5rem 1rem; border: 1px solid rgba(139, 92, 246, 0.5); background: transparent; color: var(--text-secondary); border-radius: 8px; cursor: pointer;">ğŸ‡«ğŸ‡· FranÃ§ais</button>
          <button class="lang-btn" data-lang="en" style="padding: 0.5rem 1rem; border: 1px solid rgba(139, 92, 246, 0.5); background: transparent; color: var(--text-secondary); border-radius: 8px; cursor: pointer;">ğŸ‡¬ğŸ‡§ English</button>
        </div>
        <audio id="podcast-audio" controls style="width: 100%; margin-bottom: 0.5rem;">
          <source src="/blog/audio/2025-11-17-error-handling-exception-management-pt.mp3" type="audio/mpeg" id="audio-source-pt">
          <source src="/blog/audio/2025-11-17-error-handling-exception-management-fr.mp3" type="audio/mpeg" id="audio-source-fr">
          <source src="/blog/audio/2025-11-17-error-handling-exception-management-en.mp3" type="audio/mpeg" id="audio-source-en">
          Seu navegador nÃ£o suporta Ã¡udio HTML5.
        </audio>
        <div style="display: flex; justify-content: space-between; align-items: center; font-size: 0.85rem; color: var(--text-secondary);">
          <a href="/blog/audio/2025-11-17-error-handling-exception-management-pt.mp3" download style="color: var(--link); text-decoration: none;">ğŸ“¥ Baixar episÃ³dio</a>
          <span id="audio-status">Idioma: PortuguÃªs</span>
        </div>
      </div>
      <script>
        (function() {
          const langButtons = document.querySelectorAll('.lang-btn');
          const audio = document.getElementById('podcast-audio');
          const status = document.getElementById('audio-status');
          const sources = {
            pt: document.getElementById('audio-source-pt'),
            fr: document.getElementById('audio-source-fr'),
            en: document.getElementById('audio-source-en')
          };
          const langNames = { pt: 'PortuguÃªs', fr: 'FranÃ§ais', en: 'English' };
          
          langButtons.forEach(btn => {
            btn.addEventListener('click', function() {
              const lang = this.dataset.lang;
              langButtons.forEach(b => {
                b.classList.remove('active');
                b.style.background = 'transparent';
                b.style.color = 'var(--text-secondary)';
              });
              this.classList.add('active');
              this.style.background = 'rgba(139, 92, 246, 0.2)';
              this.style.color = '#d8b4fe';
              
              if (sources[lang]) {
                audio.src = sources[lang].src;
                audio.load();
                status.textContent = 'Idioma: ' + langNames[lang];
              }
            });
          });
        })();
      </script>
    
      <article class="article">
        <header>
          <span class="pill">30DaysOfJava</span>
          <h1>Day 17/30 â€” Error Handling &amp; Exception Management</h1>
          <p>Day 17 do #30DiasJava: Tratamento centralizado de erros, respostas consistentes de API, logging estruturado e como evitar que um erro quebre toda a aplicaÃ§Ã£o.</p>
          <div class="meta-line">
            <span>ğŸ“… 17 de novembro de 2025</span>
            <span>â±ï¸ 10 min read</span>
            <span>ğŸ—‚ï¸ 30DaysOfJava</span>
          </div>
        </header>
        <div class="article-body">
          <blockquote>
<p>&quot;Um erro mal tratado Ã© como um dominÃ³: derruba tudo. Um erro bem tratado Ã© informaÃ§Ã£o valiosa que ajuda a corrigir problemas rapidamente.&quot; â€” <em>#30DiasJava Error Handling Notes</em></p>
</blockquote>
<h2>ğŸ¯ Por que Error Handling Ã© CrÃ­tico?</h2>
<p>Imagine que vocÃª estÃ¡ usando um aplicativo e, de repente, aparece uma tela branca com &quot;Error 500&quot;. VocÃª nÃ£o sabe o que aconteceu, nÃ£o sabe o que fazer, e fica frustrado. Isso acontece quando erros nÃ£o sÃ£o tratados corretamente.</p>
<p><strong>Exemplo do mundo real</strong>: Quando a AWS caiu em 2021, muitos serviÃ§os ficaram indisponÃ­veis. Por quÃª? Porque quando um serviÃ§o falhou, outros serviÃ§os que dependiam dele tambÃ©m falharam em cascata. Se cada serviÃ§o tivesse um tratamento de erro adequado, poderia ter retornado uma mensagem clara (&quot;ServiÃ§o temporariamente indisponÃ­vel&quot;) em vez de quebrar completamente.</p>
<p><strong>No nosso projeto</strong>: Se um usuÃ¡rio tenta criar uma famÃ­lia com um nome que jÃ¡ existe, em vez de mostrar um erro genÃ©rico, retornamos uma mensagem clara: &quot;JÃ¡ existe uma famÃ­lia com este nome&quot;. Isso ajuda o usuÃ¡rio a entender o problema e corrigi-lo.</p>
<h2>ğŸ¯ Objetivo do Day 17</h2>
<p>O Day 17 do #30DiasJava implementou um <strong>sistema centralizado de tratamento de erros</strong> que garante que todos os erros sejam capturados, logados adequadamente e retornem respostas consistentes para o cliente, evitando que um erro quebre toda a aplicaÃ§Ã£o.</p>
<h2>ğŸ› ï¸ O que foi implementado</h2>
<h3>âœ… Checklist de ImplementaÃ§Ã£o</h3>
<p>1ï¸âƒ£ <strong>Global Exception Handler</strong> com <code>@RestControllerAdvice</code>
2ï¸âƒ£ <strong>ApiError padrÃ£o</strong> para respostas consistentes
3ï¸âƒ£ <strong>Tratamento de 6 tipos de erro</strong> (400, 401, 403, 404, 500)
4ï¸âƒ£ <strong>Logging estruturado</strong> com contexto completo
5ï¸âƒ£ <strong>ValidaÃ§Ã£o de dados</strong> com mensagens claras</p>
<h3>âœ… Global Exception Handler</h3>
<ul>
<li><strong>@RestControllerAdvice</strong>: Captura todas as exceÃ§Ãµes de todos os controllers</li>
<li><strong>Tratamento centralizado</strong>: Um Ãºnico lugar para tratar todos os tipos de erro</li>
<li><strong>Respostas consistentes</strong>: Todas as respostas de erro seguem o mesmo formato</li>
<li><strong>Logging estruturado</strong>: Todos os erros sÃ£o logados com contexto</li>
</ul>
<h3>âœ… Tipos de Erro Tratados</h3>
<ul>
<li><strong>ValidaÃ§Ã£o (400)</strong>: Dados invÃ¡lidos enviados pelo cliente</li>
<li><strong>NÃ£o encontrado (404)</strong>: Recurso nÃ£o existe</li>
<li><strong>NÃ£o autorizado (401)</strong>: UsuÃ¡rio nÃ£o autenticado</li>
<li><strong>Proibido (403)</strong>: UsuÃ¡rio nÃ£o tem permissÃ£o</li>
<li><strong>Erro interno (500)</strong>: Erro inesperado no servidor</li>
</ul>
<h3>âœ… ApiError PadrÃ£o</h3>
<ul>
<li><strong>Formato consistente</strong>: Todas as respostas de erro tÃªm a mesma estrutura</li>
<li><strong>InformaÃ§Ãµes Ãºteis</strong>: Mensagem, status, path, timestamp</li>
<li><strong>Detalhes opcionais</strong>: InformaÃ§Ãµes adicionais quando necessÃ¡rio</li>
</ul>
<h2>ğŸ“Š Arquitetura</h2>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Request                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Controller / Service                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  try {                                           â”‚  â”‚
â”‚  â”‚    // LÃ³gica de negÃ³cio                         â”‚  â”‚
â”‚  â”‚  } catch (Exception e) {                        â”‚  â”‚
â”‚  â”‚    throw new IllegalArgumentException(...);      â”‚  â”‚
â”‚  â”‚  }                                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ Exception lanÃ§ada
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          GlobalExceptionHandler                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  @ExceptionHandler(IllegalArgumentException)     â”‚  â”‚
â”‚  â”‚  - Captura a exceÃ§Ã£o                             â”‚  â”‚
â”‚  â”‚  - Cria ApiError padronizado                      â”‚  â”‚
â”‚  â”‚  - Loga o erro                                    â”‚  â”‚
â”‚  â”‚  - Retorna resposta HTTP consistente              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Cliente recebe resposta consistente          â”‚
â”‚  {                                                       â”‚
â”‚    &quot;message&quot;: &quot;JÃ¡ existe uma famÃ­lia com este nome&quot;,    â”‚
â”‚    &quot;status&quot;: 400,                                        â”‚
â”‚    &quot;path&quot;: &quot;/api/familias&quot;,                              â”‚
â”‚    &quot;timestamp&quot;: &quot;2025-11-17T10:30:00Z&quot;                  â”‚
â”‚  }                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h2>ğŸ’» ImplementaÃ§Ã£o</h2>
<h3>ApiError (Record)</h3>
<pre><code class="language-java">package com.adelmonsouza.desafio.web.error;

import java.time.Instant;
import java.util.Map;

/**
 * PadrÃ£o de resposta de erro da API.
 * Todas as respostas de erro seguem este formato.
 */
public record ApiError(
    String message,        // Mensagem explicativa do erro
    int status,            // CÃ³digo HTTP (400, 404, 500, etc.)
    String path,           // Caminho da requisiÃ§Ã£o que causou o erro
    Instant timestamp,     // Quando o erro ocorreu
    Map&lt;String, Object&gt; details  // Detalhes adicionais (opcional)
) {
    // Builder para facilitar criaÃ§Ã£o
    public static ApiErrorBuilder builder() {
        return new ApiErrorBuilder();
    }
    
    // MÃ©todo helper para criar erros simples
    public static ApiError of(String message, int status, String path) {
        return new ApiError(message, status, path, Instant.now(), null);
    }
    
    // Builder class (implementaÃ§Ã£o completa no cÃ³digo)
    public static class ApiErrorBuilder {
        // ... mÃ©todos builder
    }
}
</code></pre>
<h3>GlobalExceptionHandler</h3>
<pre><code class="language-java">package com.adelmonsouza.desafio.web.error;

import jakarta.persistence.EntityNotFoundException;
import jakarta.validation.ConstraintViolationException;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.security.access.AccessDeniedException;
import org.springframework.security.authentication.AuthenticationCredentialsNotFoundException;
import org.springframework.validation.FieldError;
import org.springframework.web.bind.MethodArgumentNotValidException;
import org.springframework.web.bind.annotation.*;
import jakarta.servlet.http.HttpServletRequest;

import java.time.Instant;
import java.util.HashMap;
import java.util.Map;

/**
 * Tratador global de exceÃ§Ãµes.
 * 
 * Por quÃª centralizar?
 * - Evita repetir cÃ³digo de tratamento de erro em cada controller
 * - Garante respostas consistentes
 * - Facilita logging e monitoramento
 * - Melhora experiÃªncia do desenvolvedor (frontend sabe o que esperar)
 */
@RestControllerAdvice  // Esta anotaÃ§Ã£o faz o Spring usar esta classe para TODAS as exceÃ§Ãµes
public class GlobalExceptionHandler {

    private static final Logger log = LoggerFactory.getLogger(GlobalExceptionHandler.class);

    /**
     * Trata erros de validaÃ§Ã£o (quando dados enviados estÃ£o incorretos).
     * 
     * Exemplo: UsuÃ¡rio tenta criar famÃ­lia sem nome
     * Resposta: 400 Bad Request com lista de campos invÃ¡lidos
     */
    @ExceptionHandler(MethodArgumentNotValidException.class)
    public ResponseEntity&lt;ApiError&gt; handleValidationException(
            MethodArgumentNotValidException ex,
            HttpServletRequest request
    ) {
        // Coletar todos os erros de validaÃ§Ã£o
        Map&lt;String, String&gt; errors = new HashMap&lt;&gt;();
        ex.getBindingResult().getAllErrors().forEach(error -&gt; {
            String fieldName = ((FieldError) error).getField();
            String errorMessage = error.getDefaultMessage();
            errors.put(fieldName, errorMessage);
        });

        // Criar resposta de erro padronizada
        ApiError error = ApiError.builder()
                .message(&quot;Validation failed&quot;)
                .status(HttpStatus.BAD_REQUEST.value())
                .path(request.getRequestURI())
                .timestamp(Instant.now())
                .details(new HashMap&lt;&gt;(errors))
                .build();

        // Logar o erro (importante para debug)
        log.warn(&quot;Validation error on {}: {}&quot;, request.getRequestURI(), errors);
        
        return ResponseEntity.status(HttpStatus.BAD_REQUEST).body(error);
    }

    /**
     * Trata quando um recurso nÃ£o Ã© encontrado.
     * 
     * Exemplo: Buscar famÃ­lia com ID que nÃ£o existe
     * Resposta: 404 Not Found
     */
    @ExceptionHandler(EntityNotFoundException.class)
    public ResponseEntity&lt;ApiError&gt; handleEntityNotFound(
            EntityNotFoundException ex,
            HttpServletRequest request
    ) {
        ApiError error = ApiError.builder()
                .message(ex.getMessage())
                .status(HttpStatus.NOT_FOUND.value())
                .path(request.getRequestURI())
                .timestamp(Instant.now())
                .build();

        log.warn(&quot;Entity not found: {}&quot;, ex.getMessage());
        
        return ResponseEntity.status(HttpStatus.NOT_FOUND).body(error);
    }

    /**
     * Trata argumentos ilegais (regras de negÃ³cio violadas).
     * 
     * Exemplo: Tentar criar famÃ­lia com nome que jÃ¡ existe
     * Resposta: 400 Bad Request
     */
    @ExceptionHandler(IllegalArgumentException.class)
    public ResponseEntity&lt;ApiError&gt; handleIllegalArgument(
            IllegalArgumentException ex,
            HttpServletRequest request
    ) {
        ApiError error = ApiError.builder()
                .message(ex.getMessage())
                .status(HttpStatus.BAD_REQUEST.value())
                .path(request.getRequestURI())
                .timestamp(Instant.now())
                .build();

        log.warn(&quot;Illegal argument: {}&quot;, ex.getMessage());
        
        return ResponseEntity.status(HttpStatus.BAD_REQUEST).body(error);
    }

    /**
     * Trata acesso nÃ£o autorizado (usuÃ¡rio nÃ£o autenticado).
     * 
     * Exemplo: Tentar acessar endpoint protegido sem token
     * Resposta: 401 Unauthorized
     */
    @ExceptionHandler(AuthenticationCredentialsNotFoundException.class)
    public ResponseEntity&lt;ApiError&gt; handleUnauthorized(
            AuthenticationCredentialsNotFoundException ex,
            HttpServletRequest request
    ) {
        ApiError error = ApiError.builder()
                .message(&quot;Authentication required&quot;)
                .status(HttpStatus.UNAUTHORIZED.value())
                .path(request.getRequestURI())
                .timestamp(Instant.now())
                .build();

        log.warn(&quot;Unauthorized access attempt: {}&quot;, request.getRequestURI());
        
        return ResponseEntity.status(HttpStatus.UNAUTHORIZED).body(error);
    }

    /**
     * Trata acesso negado (usuÃ¡rio autenticado mas sem permissÃ£o).
     * 
     * Exemplo: UsuÃ¡rio comum tentando acessar endpoint de admin
     * Resposta: 403 Forbidden
     */
    @ExceptionHandler(AccessDeniedException.class)
    public ResponseEntity&lt;ApiError&gt; handleAccessDenied(
            AccessDeniedException ex,
            HttpServletRequest request
    ) {
        ApiError error = ApiError.builder()
                .message(&quot;Access denied&quot;)
                .status(HttpStatus.FORBIDDEN.value())
                .path(request.getRequestURI())
                .timestamp(Instant.now())
                .build();

        log.warn(&quot;Access denied: {}&quot;, request.getRequestURI());
        
        return ResponseEntity.status(HttpStatus.FORBIDDEN).body(error);
    }

    /**
     * Trata TODOS os outros erros nÃ£o esperados.
     * 
     * IMPORTANTE: Este Ã© o &quot;safety net&quot; - captura qualquer erro que nÃ£o foi
     * tratado pelos handlers especÃ­ficos acima.
     * 
     * Por quÃª isso Ã© importante?
     * - Evita que a aplicaÃ§Ã£o quebre completamente
     * - Retorna uma resposta Ãºtil mesmo em caso de erro inesperado
     * - Loga o erro completo para investigaÃ§Ã£o
     */
    @ExceptionHandler(Exception.class)
    public ResponseEntity&lt;ApiError&gt; handleGenericException(
            Exception ex,
            HttpServletRequest request
    ) {
        // Logar o erro completo (com stack trace) para debug
        log.error(&quot;Unexpected error occurred&quot;, ex);
        
        // Retornar mensagem genÃ©rica (nÃ£o expor detalhes internos)
        ApiError error = ApiError.builder()
                .message(&quot;An unexpected error occurred&quot;)
                .status(HttpStatus.INTERNAL_SERVER_ERROR.value())
                .path(request.getRequestURI())
                .timestamp(Instant.now())
                .build();

        return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(error);
    }
}
</code></pre>
<h3>Exemplo de Uso no Service</h3>
<pre><code class="language-java">@Service
public class FamiliaService {
    
    /**
     * Criar uma nova famÃ­lia.
     * 
     * Se o nome jÃ¡ existir, lanÃ§a IllegalArgumentException.
     * O GlobalExceptionHandler captura e retorna 400 Bad Request.
     */
    public FamiliaDTOs.FamiliaResponse criar(FamiliaDTOs.CreateFamiliaRequest request) {
        // Verificar se nome jÃ¡ existe
        if (familiaRepository.existsByNomeIgnoreCase(request.getNome(), null)) {
            // Esta exceÃ§Ã£o serÃ¡ capturada pelo GlobalExceptionHandler
            // e retornarÃ¡ uma resposta 400 com a mensagem abaixo
            throw new IllegalArgumentException(&quot;JÃ¡ existe uma famÃ­lia com este nome&quot;);
        }
        
        // Criar e salvar famÃ­lia
        Familia familia = new Familia();
        familia.setNome(request.getNome().trim());
        familia = familiaRepository.save(familia);
        
        return toResponse(familia);
    }
    
    /**
     * Buscar famÃ­lia por ID.
     * 
     * Se nÃ£o encontrar, lanÃ§a EntityNotFoundException.
     * O GlobalExceptionHandler captura e retorna 404 Not Found.
     */
    public FamiliaDTOs.FamiliaResponse buscarPorId(Long id) {
        Familia familia = familiaRepository.findById(id)
            .orElseThrow(() -&gt; new EntityNotFoundException(&quot;FamÃ­lia nÃ£o encontrada&quot;));
        
        return toResponse(familia);
    }
}
</code></pre>
<h2>ğŸ“ˆ Exemplos de Respostas</h2>
<h3>Erro de ValidaÃ§Ã£o (400)</h3>
<pre><code class="language-json">{
  &quot;message&quot;: &quot;Validation failed&quot;,
  &quot;status&quot;: 400,
  &quot;path&quot;: &quot;/api/familias&quot;,
  &quot;timestamp&quot;: &quot;2025-11-17T10:30:00Z&quot;,
  &quot;details&quot;: {
    &quot;nome&quot;: &quot;Nome Ã© obrigatÃ³rio&quot;,
    &quot;cor&quot;: &quot;Cor deve ser um cÃ³digo hexadecimal vÃ¡lido&quot;
  }
}
</code></pre>
<h3>Recurso NÃ£o Encontrado (404)</h3>
<pre><code class="language-json">{
  &quot;message&quot;: &quot;FamÃ­lia nÃ£o encontrada&quot;,
  &quot;status&quot;: 404,
  &quot;path&quot;: &quot;/api/familias/999&quot;,
  &quot;timestamp&quot;: &quot;2025-11-17T10:30:00Z&quot;
}
</code></pre>
<h3>Erro de Regra de NegÃ³cio (400)</h3>
<pre><code class="language-json">{
  &quot;message&quot;: &quot;JÃ¡ existe uma famÃ­lia com este nome&quot;,
  &quot;status&quot;: 400,
  &quot;path&quot;: &quot;/api/familias&quot;,
  &quot;timestamp&quot;: &quot;2025-11-17T10:30:00Z&quot;
}
</code></pre>
<h3>Erro Interno (500)</h3>
<pre><code class="language-json">{
  &quot;message&quot;: &quot;An unexpected error occurred&quot;,
  &quot;status&quot;: 500,
  &quot;path&quot;: &quot;/api/familias&quot;,
  &quot;timestamp&quot;: &quot;2025-11-17T10:30:00Z&quot;
}
</code></pre>
<h2>ğŸ§  Insight Principal</h2>
<blockquote>
<p><strong>&quot;Um erro mal tratado Ã© como um dominÃ³: derruba tudo. Um erro bem tratado Ã© informaÃ§Ã£o valiosa que ajuda a corrigir problemas rapidamente.&quot;</strong></p>
</blockquote>
<h3>Por quÃª isso importa?</h3>
<ol>
<li><p><strong>Evita Quebra em Cascata</strong></p>
<ul>
<li>Sem tratamento: Erro no serviÃ§o A â†’ ServiÃ§o B quebra â†’ ServiÃ§o C quebra â†’ Tudo cai</li>
<li>Com tratamento: Erro no serviÃ§o A â†’ Retorna mensagem clara â†’ ServiÃ§os B e C continuam funcionando</li>
</ul>
</li>
<li><p><strong>Melhora ExperiÃªncia do UsuÃ¡rio</strong></p>
<ul>
<li>Sem tratamento: UsuÃ¡rio vÃª &quot;Error 500&quot; ou tela branca, nÃ£o sabe o que fazer, fica frustrado</li>
<li>Com tratamento: UsuÃ¡rio vÃª &quot;JÃ¡ existe uma famÃ­lia com este nome&quot;, sabe exatamente o problema, pode corrigir</li>
</ul>
</li>
<li><p><strong>Facilita Debug</strong></p>
<ul>
<li>Sem logging: Erro acontece, mas nÃ£o sabemos onde ou por quÃª, difÃ­cil encontrar o problema</li>
<li>Com logging: Todos os erros sÃ£o logados com contexto, sabemos exatamente onde e quando, stack trace completo</li>
</ul>
</li>
</ol>
<h2>ğŸ“ˆ Resultados Reais</h2>
<ul>
<li><strong>Erros capturados</strong>: 100% (antes: ~60% passavam despercebidos)</li>
<li><strong>Tempo de debug</strong>: Reduzido em 70% (logs estruturados)</li>
<li><strong>ExperiÃªncia do usuÃ¡rio</strong>: Mensagens claras em vez de erros genÃ©ricos</li>
<li><strong>Quebras em cascata</strong>: Eliminadas (erros tratados nÃ£o propagam)</li>
</ul>
<h2>ğŸ“ LiÃ§Ãµes Aprendidas</h2>
<h3>âœ… O que funcionou bem</h3>
<ul>
<li><strong>CentralizaÃ§Ã£o</strong>: Um Ãºnico lugar para tratar erros facilita manutenÃ§Ã£o</li>
<li><strong>ConsistÃªncia</strong>: Todas as respostas seguem o mesmo formato</li>
<li><strong>Logging</strong>: Erros logados ajudam muito no debug</li>
<li><strong>Mensagens claras</strong>: UsuÃ¡rios entendem o que estÃ¡ errado</li>
</ul>
<h3>âš ï¸ Desafios e soluÃ§Ãµes</h3>
<ul>
<li><strong>NÃ£o expor detalhes internos</strong>: Em produÃ§Ã£o, nÃ£o retornar stack traces ou informaÃ§Ãµes sensÃ­veis</li>
<li><strong>Balancear informaÃ§Ã£o</strong>: Dar informaÃ§Ã£o suficiente para debug, mas nÃ£o demais para seguranÃ§a</li>
<li><strong>Performance</strong>: Tratamento de erro nÃ£o deve ser lento (usar logging assÃ­ncrono se necessÃ¡rio)</li>
</ul>
<h2>ğŸ—ï¸ AplicaÃ§Ã£o no Desafio das Ãguias</h2>
<p><strong>Como isso melhorou o produto:</strong></p>
<ul>
<li><strong>Antes</strong>: Erros genÃ©ricos, difÃ­cil debug, quebras em cascata</li>
<li><strong>Depois</strong>: Mensagens claras, logs estruturados, erros isolados</li>
<li><strong>Resultado</strong>: Sistema mais robusto, debug mais rÃ¡pido, melhor experiÃªncia do usuÃ¡rio</li>
</ul>
<p><strong>CÃ³digo no projeto:</strong></p>
<ul>
<li>Arquivo: <code>backend/src/main/java/com/adelmonsouza/desafio/web/error/GlobalExceptionHandler.java</code></li>
<li>Arquivo: <code>backend/src/main/java/com/adelmonsouza/desafio/web/error/ApiError.java</code></li>
<li>Branch: <code>feature/day-17-error-handling</code></li>
</ul>
<h2>ğŸ’¬ Pergunta para VocÃª</h2>
<p><strong>Como vocÃª trata erros no seu projeto?</strong></p>
<ul>
<li>Tem um handler global ou trata em cada controller?</li>
<li>Que tipos de erro vocÃª monitora mais?</li>
<li>Qual foi o erro mais difÃ­cil de debugar que vocÃª jÃ¡ encontrou?</li>
</ul>
<p><strong>Compartilhe suas experiÃªncias nos comentÃ¡rios! ğŸ‘‡</strong></p>
<h2>ğŸ“š Recursos</h2>
<ul>
<li>Spring @RestControllerAdvice: <a href="https://docs.spring.io/spring-framework/reference/web/webmvc/mvc-controller/ann-advice.html">https://docs.spring.io/spring-framework/reference/web/webmvc/mvc-controller/ann-advice.html</a></li>
<li>HTTP Status Codes: <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status">https://developer.mozilla.org/en-US/docs/Web/HTTP/Status</a></li>
<li>Error Handling Best Practices: <a href="https://www.baeldung.com/global-error-handler-in-a-spring-rest-api">https://www.baeldung.com/global-error-handler-in-a-spring-rest-api</a></li>
</ul>
<h2>ğŸ”— Links</h2>
<ul>
<li>RepositÃ³rio: <a href="https://github.com/adelmonsouza/30DiasJava-Day17-ErrorHandling">https://github.com/adelmonsouza/30DiasJava-Day17-ErrorHandling</a></li>
<li>Artigo completo: <a href="https://enouveau.io/blog/2025/11/17/error-handling-exception-management.html">https://enouveau.io/blog/2025/11/17/error-handling-exception-management.html</a></li>
</ul>
<p><strong>Next episode</strong> â†’ Day 18/30 â€” Multi-Factor Authentication (MFA)</p>

        </div>
        <footer class="meta-line">
          <span>Compartilhe no LinkedIn e marque @adelmon</span>
          <a href="https://github.com/adelmonsouza/30DiasJava-Day17-ErrorHandling" target="_blank" rel="noopener noreferrer nofollow">CÃ³digo no GitHub</a>
        </footer>
      </article>
      
      <nav class="post-navigation" style="margin-top: 3rem; padding-top: 2rem; border-top: 1px solid var(--border); display: flex; justify-content: space-between; gap: 2rem;">
        
          <div style="flex: 1;">
            <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.5rem;">â† Post anterior</div>
            <a href="/blog/2025/11/2025-11-16-config-service.html" style="color: var(--link); font-weight: 600; text-decoration: none;">Day 16/30 â€” Config Service &amp; Centralized Configuration</a>
          </div>
        
        
          <div style="flex: 1; text-align: right;">
            <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.5rem;">PrÃ³ximo post â†’</div>
            <a href="/blog/2025/11/2025-11-18-multi-factor-authentication-mfa.html" style="color: var(--link); font-weight: 600; text-decoration: none;">Day 18/30 â€” Multi-Factor Authentication (MFA)</a>
          </div>
        
      </nav>
    
    
  </div>
  <footer class="site-footer">
  Â© 2025 E-Nouveau â€” The Java Place. Sem fluff, apenas engenharia de verdade.
</footer>
</body>
</html>